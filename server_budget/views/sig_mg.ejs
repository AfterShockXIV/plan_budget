<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Budget : <%= department %>
  </title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous" />
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
    integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
    integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
    crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
    integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
    crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
    integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous" />

  <script src="https://code.jquery.com/jquery-3.5.1.js" crossorigin="anonymous"></script>
  <script src="https://cdn.datatables.net/1.11.4/js/jquery.dataTables.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.datatables.net/1.11.4/js/dataTables.bootstrap5.min.js" crossorigin="anonymous"></script>
</head>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.0.1/css/bootstrap.min.css"
  crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdn.datatables.net/1.11.4/css/dataTables.bootstrap5.min.css"
  crossorigin="anonymous" />




<style>
  @import url("https://fonts.googleapis.com/css2?family=Prompt&display=swap");

  body {
    /* font-size: 13px; */
    font-family: "Prompt", sans-serif;

  }
</style>
<style>
  .bg {
    text-align: center;
    border-radius: 5px;
    font-size: 30px;
    font-weight: bold;
    /* box-shadow: 0 30px 50px rgba(0, 0, 0, 0.287); */
    font-family: "Prompt", sans-serif;
    /* background-color: rgb(255, 255, 255); */
    /* background-color: #414141; */
    /* background: -webkit-gradient(linear, left top, right top, from(sandybrown),color-stop(30%, #ff8800), to(#fff)); */
    /* background-color: #cfcfcf; */
    color: #fff;
    background-color: aliceblue;
    width: 100%;
    padding: 2% 0 2% 0;
    /* background-color: #878787; */
    background: -webkit-gradient(linear, left top, right top, from(#878787), color-stop(40%, #777777), to(#ededed));
    border-radius: 20px;

  }

  .bg1 {
    border: 2px solid #fff;
    border-radius: 10px;
    margin-left: 5%;
    /* padding: 5% 3% 1% 3%; */
    text-align: left;
    width: 90%;
    height: auto;
    font-family: "Prompt", sans-serif;
    /* background-color: rgba(247, 242, 242, 0.671); */
    /* background-color: cornsilk ; */
    display: inline-block;
    margin-top: 3%;
    margin-right: 5%;
    padding-bottom: 5%;
    background-color: rgba(255, 255, 255, 0.836);
    box-shadow: 0 30px 50px rgba(0,0,0,.2);
    border-radius: 20px;
  }

  .wrapper {
    position: relative;
    width: 100%;
    height: 200px;
    -moz-user-select: none;
    -webkit-user-select: none;
    -ms-user-select: none;
    user-select: none;
    /* margin-left: 30%; */
  }

  .signature-pad {
    left: 0;
    top: 0;
    width: 60%;
    height: 200px;
    background-color: rgb(255, 255, 255);
    border: 1px solid rgb(0, 0, 0);
    margin-top: 2%;
    margin-bottom: 1%;
  }

  label {
    /* display:flex; */
    /* justify-content:center; */
    padding-top: 5px;
    margin-left: 10%;
    margin-top: 20px;
    margin-right: 6%;
    font-size: 17px;
    /* text-align: center !important; */

  }

  /* td {
    padding-top: 5px;
    padding-left: 15%;
    margin-left: 50% !important;
    margin-bottom: 3%;
    margin-top: 4%;
    font-size: 17px;
  } */

  /* .input {
    border-radius: 10px;
    width: 70%;
    border: 1px solid #cfcfcf;
    padding: 10px 0 10px 10px;
    margin-top: 3%;
  } */

  .dtHorizontalExampleWrapper {
max-width: 100%;

}
#dtHorizontalExample th, td,tr {
white-space: nowrap;
}

/* table.dataTable thead .sorting:after,
table.dataTable thead .sorting:before,
table.dataTable thead .sorting_asc:after,
table.dataTable thead .sorting_asc:before,
table.dataTable thead .sorting_asc_disabled:after,
table.dataTable thead .sorting_asc_disabled:before,
table.dataTable thead .sorting_desc:after,
table.dataTable thead .sorting_desc:before,
table.dataTable thead .sorting_desc_disabled:after,
table.dataTable thead .sorting_desc_disabled:before {
bottom: .5em;
} */

.scroll_table {
       width: 100%;
       overflow-x: scroll;
       /* white-space: nowrap; */
   }

   body{
      background-image: url("/assets/bg/bg-jot.png");
      background-repeat : no-repeat; 
 background-position : top left;   
 background-attachment: fixed; 
  background-size: 200%;
  height: auto;
    } 
</style>
<script src="https://cdn.jsdelivr.net/npm/signature_pad@2.3.2/dist/signature_pad.min.js"></script>
<!-- style="background-color: #e0e0de" -->
<script>
  $(document).ready(function () {
$('#dtHorizontalExample').DataTable({

});
$('.dataTables_length').addClass('bs-select');
});
</script>
<body>


  <div class="bg1">
    <!-- <div class="col-1"><label></label> <br /></div> -->
    <div class="bg">Approve Budget </div>
    <label>ฝ่ายงาน : <%= department %> </label> <br />
    <label>เรียน : <%= learn_job %></label> <br />
    <label>สำเนาเรียน : <%= learn_job_copy %></label><br />
    <label>เรื่อง :<%= project_name %></label><br />
    <label>รายละเอียด : <%= detail_job %></label> <br /> <br />
    <button type="button" data-toggle="modal" data-target=".bd-example-modal-lg"
      style="background-color: #01a6ba;  border-radius: 5px; border-color: #01a6ba; padding: 5px 15px 5px 15px; margin-left: 10%; color: #ffffff;"
      class="btn btn-success">
      ดูรายการ
    </button> <br />
    <label>แผนงบปี : <%= job_project_year %></label><br />
    <label>ระยะเวลา : <%= job_time %> &nbsp;เดือน</label><br />
    <label style="padding-right: 100px">ยอด : <%= job_project_price.toString() .replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1,"
        ) %></label>


    <hr style="width: 80%; margin-left: 10%; height: 2px; margin-bottom: 2%; margin-top: 1%;" />

    <div style="text-align: center">
      <u style="font-weight: bold; font-size: 17px; ">ลายเซ็นผู้จัดการ</u><br />
      <canvas id="signature-pad" name="canvas" class="signature-pad"></canvas>
    </div>
    <br />

    <form action="/post_sig_mg" method="post">
      <div class="text-center">
        <button type="button"
          style="border-radius: 10px; background-color: red; color: #fff; border-color: red; padding: 5px 40px 5px 40px"
          id="clear"
          class="btn btn-success">
          Clear
        </button>

        <input hidden type="text" id="demo" name="mg_sig" value="" />
        <input hidden type="text" value="<%= job_run_id %>" name="job_run_id" />
        <button type="submit"
          style="border-radius: 10px; background-color: #198754; color: #fff; border-color:#198754; padding: 5px 10px 5px 10px"
          id="save-jpeg"
          class="btn btn-success">
          ตรวจสอบเรียบร้อย
        </button>
      </div>
    </form>
  </div>

  <!-- Modal -->

  <div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel"
    aria-hidden="true">
    
    <div class="modal-dialog modal-lg" style="width: 100;">
      <div class="modal-content" style="width: 100%;">

        <div class="modal-body" style="zoom:85%; width: 100%;">

          <h4>รวมยอด : <%= job_project_price.toString() .replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1," ) %>
          </h4>
          <div class="scroll_table">
          <table id="dtHorizontalExample" class="table table-striped table-bordered table-md " cellspacing="0"
           >
            <thead>
              <tr>
                <th style="text-align: center;">ลำดับ</th>
                <th style="text-align: center;">รายการ</th>
                <th style="width:100%; text-align: center;">จำนวน</th>
                <th style="width:100%; text-align: center;">ราคาต่อหน่วย</th>
                <th style="width:100%; text-align: center;">หน่วยนับ</th>
                <th style="width:100%; text-align: center;">รวม</th>
                <th style="width:100%; text-align: center;">สกุลเงิน</th>
              </tr>
            </thead>

            <tbody>
              <% all_detail.forEach((data, index)=> { %>
                <tr>
                  <td><%= index+1 %></td>
                  <td >
                    <%= data.detail_list_job %>
                  </td>
                  <td style="text-align: right;">
                    <%= data.detail_qty_job.toString() .replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1," ) %>
                  </td>
                  <td style="text-align: right;">
                    <%= data.detail_price_job.toString() .replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1," ) %>
                  </td>
                  <td style="text-align: right;">
                    <%= data.detail_unit_job.toString() .replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1," ) %>
                  </td>
                  <td style="text-align: right;">
                    <%= data.detail_sum_job.toString() .replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1," ) %>
                  </td>
                  <td style="text-align: right;">
                    <%= data.detail_CURR_job %>
                  </td>
                </tr>
                <% }) %>
            </tbody>

          </table>
        </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal -->
  </div>
</body>

</html>

<script type="text/javascript">
  var canvas = document.getElementById("signature-pad");

  // Adjust canvas coordinate space taking into account pixel ratio,
  // to make it look crisp on mobile devices.
  // This also causes canvas to be cleared.
  function resizeCanvas() {
    // When zoomed out to less than 100%, for some very strange reason,
    // some browsers report devicePixelRatio as less than 1
    // and only part of the canvas is cleared then.
    var ratio = Math.max(window.devicePixelRatio || 1, 1);
    canvas.width = canvas.offsetWidth * ratio;
    canvas.height = canvas.offsetHeight * ratio;
    canvas.getContext("2d").scale(ratio, ratio);
  }

  window.onresize = resizeCanvas;
  resizeCanvas();

  var signaturePad = new SignaturePad(canvas, {
    backgroundColor: "rgb(255, 255, 255)", // necessary for saving image as JPEG; can be removed is only saving as PNG or SVG
  });
  document.getElementById("save-jpeg").addEventListener("click", function () {
    if (signaturePad.isEmpty()) {
    } else {
      var canvas = document.getElementById("signature-pad");
      var dataURL = canvas.toDataURL();

      document.getElementById("demo").value = dataURL;
      x.innerText = dataURL;
    }
  });

  document.getElementById("clear").addEventListener("click", function () {
    signaturePad.clear();
  });
</script>